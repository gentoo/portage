#!@PORTAGE_PYTHON@ -O
# Copyright 1999-2006 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Id$

import os, sys, errno

def usage(status):
	print "Usage: env-update [--no-ldconfig]"
	print ""
	print "See the env-update(1) man page for more info"
	sys.exit(status)

if "-h" in sys.argv or "--help" in sys.argv:
	usage(0)

makelinks=1
if "--no-ldconfig" in sys.argv:
	makelinks=0
	sys.argv.pop(sys.argv.index("--no-ldconfig"))

if len(sys.argv) > 1:
	print "!!! Invalid command line options!\n"
	usage(1)

# for an explanation on this logic, see pym/_emerge/__init__.py
import os
import sys
if os.environ.__contains__("PORTAGE_PYTHONPATH"):
	sys.path.insert(0, os.environ["PORTAGE_PYTHONPATH"])
else:
	sys.path.insert(0, os.path.join(os.path.dirname(os.path.dirname(os.path.realpath(__file__))), "pym"))
import portage

try:
	portage.env_update(makelinks)
except IOError, e:
	if e.errno == errno.EACCES:
		print "env-update: Need superuser access"
		sys.exit(1)
	else:
		raise
