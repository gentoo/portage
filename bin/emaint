#!/usr/bin/env python
# Copyright 2005-2020 Gentoo Authors
# Distributed under the terms of the GNU General Public License v2

"""System health checks and maintenance utilities.
"""

import sys
import errno
import signal

# This ensures that ^C interrupts are handled quietly.
signal.signal(signal.SIGINT, signal.SIG_DFL)

# Prevent "[Errno 32] Broken pipe" exceptions when writing to a pipe.
signal.signal(signal.SIGPIPE, signal.SIG_DFL)

from os import path as osp

if osp.isfile(
    osp.join(osp.dirname(osp.dirname(osp.realpath(__file__))), ".portage_not_installed")
):
    sys.path.insert(
        0, osp.join(osp.dirname(osp.dirname(osp.realpath(__file__))), "lib")
    )
import portage

portage._internal_caller = True
from portage.emaint.main import emaint_main
from portage.util._eventloop.global_event_loop import global_event_loop

try:
    emaint_main(sys.argv[1:])
except OSError as e:
    if e.errno == errno.EACCES:
        print("\nemaint: Need superuser access")
        sys.exit(1)
    else:
        raise
finally:
    global_event_loop().close()
