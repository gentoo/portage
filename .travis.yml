language: python
python:
    - 2.7
    - 3.4
    - 3.5
    - 3.6
    - pypy

# See https://github.com/travis-ci/travis-ci/issues/9815
matrix:
  include:
    - python: 3.7
      dist: xenial
      sudo: required

# command to install dependencies
install:
    - pip install tox

# Cache pip to shave a few seconds
cache:
  pip: true

before_install:
  - export -f travis_fold

script:
    - printf "[build_ext]\nportage-ext-modules=true" >> setup.cfg
    - |
      echo "travis_fold:start:setup.py_test"
      ./setup.py test
      echo "travis_fold:end:setup.py_test"
    - |
      echo "travis_fold:start:setup.py_install"
      ./setup.py install --root=/tmp/install-root
      echo "travis_fold:end:setup.py_install"
    - |
      echo "travis_fold:start:tox"
      if [[ ${TRAVIS_PYTHON_VERSION} == ?.? ]]; then
        tox -e py${TRAVIS_PYTHON_VERSION/./};
      else
        tox -e ${TRAVIS_PYTHON_VERSION};
      fi
      echo "travis_fold:end:tox"
