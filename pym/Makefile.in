SHELL = @PORTAGE_BASH@

prefix = @prefix@
exec_prefix = @exec_prefix@
sysconfdir = @sysconfdir@
libdir = @libdir@
PYTHON = @PREFIX_PORTAGE_PYTHON@

srcdir=@srcdir@
top_builddir=@top_builddir@

portageuser = @portageuser@
portagegroup = @portagegroup@

PORTAGE_PYM = @PORTAGE_BASE@/pym
INSTALL = @INSTALL@
INSTALL_subst = ${top_builddir}/subst-install

all:

install:
	$(INSTALL) -d -m 755 -o "$(portageuser)" -g "$(portagegroup)" $(DESTDIR)$(PORTAGE_PYM)
	( cd "$(srcdir)" && find * -type d ) | while read f ; do \
		files=( ) ; \
		shopt -s nullglob ; \
		for t in "$(srcdir)/$${f}"/* ; do \
			[[ -d $${t} ]] && continue ; \
			[[ $${t} == */Makefile* ]] && continue ; \
			files=( "$${files[@]}" "$${t}" ) ; \
		done ; \
		$(INSTALL) -d -m 755 \
			-o "$(portageuser)" -g "$(portagegroup)" \
			"$(DESTDIR)$(PORTAGE_PYM)/$${f}" && \
		[[ $${files[0]} ]] || continue ; \
		$(INSTALL_subst) \
			-o "$(portageuser)" -g "$(portagegroup)" \
			-t "$(DESTDIR)$(PORTAGE_PYM)/$${f}" \
			"$${files[@]}" \
	; done

.PHONY:	all install
