=========
egencache
=========

-------------------------------------------------
Generate a metadata cache for ebuild repositories
-------------------------------------------------

:Authors:
    - Zac Medico <zmedico@gentoo.org>
    - Arfrever Frehtes Taifersar Arahesis <arfrever@apache.org>
    - Oskari Pirhonen <xxc3ncoredxx@gmail.com>
:Date: 2022-09-17
:Copyright:
    Copyright 1999-2022 Gentoo Authors.  Distributed under the terms of the
    GNU General Public License v2
:Version: Portage VERSION
:Manual section: 1
:Manual group: Portage


Synopsis
========

``egencache`` [options_] [actions_] *atom* ...


Description
===========

``egencache`` generates *metadata cache* information for the *atoms* listed on
the command line and stores it in the *metadata/md5-cache* directory within the
repository for distribution.


Options
=======

--cache-dir=CACHE_DIR
    Location of the intermediate metadata cache which is stored in a different
    format and includes the *eclass* state (default is ``/var/cache/edb/dep``).
    See the BUGS_ section for information on why this is necessary.

--changelog-output=FILENAME
    The filename used to store autogenerated *ChangeLogs* inside the package
    directories (default is ``ChangeLog``).

--changelog-reversed
    Reverse the commit order in *ChangeLogs*.  The default order is reverse-\
    chronological (newest at the top).

--config-root=PORTAGE_CONFIGROOT
    Location of Portage configuration files (default is ``/``).

--external-cache-only
    Output only to the external cache and not to the repository itself.  This is
    useful for client-side usage where it may not be possible to output to the
    repository itself to interfering with repository verification.  Supported by
    ``--update`` and ``--update-pkg-desc-index``.

--gpg-dir
    Override the *PORTAGE_GPG_DIR* variable.

--gpg-key
    Override the *PORTAGE_GPG_KEY* variable.

--ignore-default-opts
    Ignore options set in the *EGENCACHE_DEFAULT_OPTS* variable.

--jobs=JOBS
    Maximum number of concurrent *ebuild* processes to run.

--load-average=LOAD
    Maximum load average where spawning new jobs is allowed.

--preserve-comments
    Preserve the comments found in the output *use.local.desc* file.  This
    requires the output file to exist before running ``egencache``.

--repo=REPO
    Name of the repository to operate on.  The name should correspond the value
    of a *repo_name* entry for a repository (see ``portage``\ (5)).

--repositories-configuration=REPOSITORIES_CONFIGURATION
    Override repository configuration.  The format is the same as for
    *repos.conf* (see ``portage``\ (5)).

--rsync
    When used together with ``--update``, enable a workaround for cases where
    the content of a *cache* entry changes but neither the file *mtime* nor size
    change which prevents *rsync* from detecting changes.  This is handled by
    bumping the *mtime* on the *ebuild* and its corresponding *cache* entry.
    This should only be needed for distribution via something like
    ``rsync``\ (1) which relies on timestamps and file sizes to detect changes
    (see bug 139134).  This is not needed with ``git``\ (1) since it uses a more
    robust mechanism that allows detecting changed *inode* numbers.  See also
    *racy-git.txt* in the *git* technical documentation.

--sign-manifests <y|n>
    Override the *sign-manifests* setting from *layout.conf*.

--strict-manifests <y|n>
    Override the ``strict`` option in *FEATURES*.

--thin-manifests <y|n>
    Override the *thin-manifests* setting from *layout.conf*.

--tolerant
    Exit successfully if only minor errors occurred such as skipped *cache*
    updates caused by *ebuilds* failing to be sourced or are not sourced due to
    invalid *Manifest* entries.

--use-local-desc-output=FILE
    File to output the new *use.local.desc* data to (use ``-`` for *stdout*).

--verbose, -v
    More verbose output.

--write-timestamp
    Create the *metadata/timestamp.chk* file which is required for *rsync*
    repositories.


Actions
=======

--update
    Update the *metadata/md5-cache* directory, generating metadata as needed.
    If no *atoms* are specified then update all packages.  See ``ebuild``\ (5)
    for the *atom* syntax.

--update-changelogs
    Update the *ChangeLog* files with information from SCM logs (currently only
    supported for *git* repositories).

--update-pkg-desc-index
    Update the package description index located in the repository at
    *metadata/pkg_desc_index*.

--update-use-local-desc
    Update the *profiles/use.local.desc* file with information from package
    *metadata.xml*.

--update-manifests
    Update package *Manifest* files and sign them if signing is enabled.
    Parallelization is supported through the ``--jobs`` option.


Bugs
====

Prior to portage-2.1.11.32, the *pms* cache format was enabled by default.  This
*pms* format, which is distributed in the *metadata/cache* directory of the
repository, has significant limitations related to the cache validation
mechanism which involves comparing a cache entry's *mtime* with the *mtime* of
the corresponding *ebuild*.  This mechanism is unreliable in cases where
*eclass* changes result in metadata changes since no information about *eclass*
state is available in the cache.  Also, because the *mtime* of the cache entry
must correspond to that of the *ebuild*, the cache format is only suitable for
distribution via protocols that preserve timestamps (such as *rsync*).  For
cache that is distributed  via *git* repositories there is currently a
workaround implemented in ``emerge --sync`` which updates *ebuild* *mtimes* to
match their corresponding cache entries (except for *ebuilds* that are modified
relative to *HEAD*).

In order to solve the above problems, the newer *md5-dict* format has been
enabled by default since portage-2.1.11.32.  This format is distributed in the
*metadata/md5-cache* directory of the repository and includes additional
validation data in the form of *digests* for both the *ebuild* and its inherited
*eclasses*.

.. WARNING::
   Portage versions prior to portage-2.1.11.14 will NOT recognize the *md5-dict*
   format unless it is explicitly listed in *meta-data/layout.conf*
   (see ``portage``\ (5) for examples).

   For backwards compatibility, the obsolete *pms* cache format will still be
   generated by default if the *metadata/cache* directory exists in the
   repository.  It can also be explicitly enabled via the *cache-formats*
   setting in *metadata/layout.conf* (see ``portage``\ (5) for examples).  If
   the *pms* cache format is enabled and the *md5-dict* format is not enabled
   then it is necessary to enable ``metadata-transfer`` in *FEATURES*
   (see ``make.conf``\ (5)).  This causes intermediate caches (in a different
   format that includes *eclass* state) to be generated inside the directory
   which is configurable via the ``--cache-dir`` option.


Reporting Bugs
==============

Please report bugs via https://bugs.gentoo.org/


Files
=====

/etc/portage/make.conf
    Contains Portage environment variables.


Environment Variables
=====================

EGENCACHE_DEFAULT_OPTS
    Set of default options used for ``egencache``.


See Also
========

``ebuild``\ (5)
``make.conf``\ (5)
``portage``\ (5)
